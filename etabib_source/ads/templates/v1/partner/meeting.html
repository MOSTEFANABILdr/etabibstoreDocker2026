{% extends "base.html" %}
{% load i18n utils_tags ads_tags role_tags %}
{% load static %}
{% block title %}  {% endblock %}
{% block style %}
<!-- Google Fonts
                    ============================================ -->
<link
        href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,700,900"
        rel="stylesheet">
<!-- Bootstrap CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/bootstrap.min.css" %}'>
<!-- Bootstrap CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/font-awesome.min.css" %}'>
<!-- owl.carousel CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/owl.carousel.css" %}'>
<link rel="stylesheet" href='{% static "css/owl.theme.css" %}'>
<link rel="stylesheet" href='{% static "css/owl.transitions.css" %}'>
<!-- animate CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/animate.css" %}'>
<!-- normalize CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/normalize.css" %}'>
<!-- meanmenu icon CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/meanmenu.min.css" %}'>
<!-- main CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/main.css" %}'>
<!-- educate icon CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/educate-custon-icon.css" %}'>
<!-- morrisjs CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/morrisjs/morris.css" %}'>
<!-- mCustomScrollbar CSS
                    ============================================ -->
<link rel="stylesheet"
      href='{% static "css/scrollbar/jquery.mCustomScrollbar.min.css" %}'>
<!-- metisMenu CSS
                    ============================================ -->
<link rel="stylesheet"
      href='{% static "css/metisMenu/metisMenu.min.css" %}'>
<link rel="stylesheet"
      href='{% static "css/metisMenu/metisMenu-vertical.css" %}'>
<!-- modernizr JS
                    ============================================ -->
<script src='{% static "js/vendor/modernizr-2.8.3.min.js" %}'></script>
<!-- jquery countdown css ============================================ -->
<link rel="stylesheet" href='{% static "css/countdown/css/jquery.countdown.css" %}'>
<style>
#meet {
   height: 500px;
}
</style>
{% endblock %}
{% block content %}
<div class="product-status mg-b-15">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="product-status-wrap drp-lst latest-blog-single blog-single-full-view">
                    <h1><a class="blog-ht" href="#">{{stand.signaletique}}</a></h1>
                </div>
            </div>
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="d-flex flex-column bd-highlight mb-3">
                    <div class="text-center" id="meet">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block js %}
<!-- bootstrap JS
                    ============================================ -->
<script src='{% static "js/bootstrap.min.js" %}'></script>
<!-- wow JS
                    ============================================ -->
<script src='{% static "js/wow.min.js" %}'></script>
<!-- price-slider JS
                    ============================================ -->
<script src='{% static "js/jquery-price-slider.js" %}'></script>
<!-- meanmenu JS
                    ============================================ -->
<script src='{% static "js/jquery.meanmenu.js" %}'></script>
<!-- owl.carousel JS
                    ============================================ -->
<script src='{% static "js/owl.carousel.min.js" %}'></script>
<!-- sticky JS
                    ============================================ -->
<script src='{% static "js/jquery.sticky.js" %}'></script>
<!-- scrollUp JS
                    ============================================ -->
<script src='{% static "js/jquery.scrollUp.min.js" %}'></script>
<!-- mCustomScrollbar JS
                    ============================================ -->
<script
        src='{% static "js/scrollbar/jquery.mCustomScrollbar.concat.min.js" %}'></script>
<script src='{% static "js/scrollbar/mCustomScrollbar-active.js" %}'></script>
<!-- metisMenu JS
                    ============================================ -->
<script src='{% static "js/metisMenu/metisMenu.min.js" %}'></script>
<script src='{% static "js/metisMenu/metisMenu-active.js" %}'></script>
<!-- plugins JS
                    ============================================ -->
<script src='{% static "js/plugins.js" %}'></script>
<!-- main JS
                    ============================================ -->
<script src='{% static "js/main.js" %}'></script>
<!-- tawk chat JS
                    ============================================ -->
{% include 'partial/tawk-script.html' %}
<script src='https://{% settings_value "ECONGRE_JITSI_DOMAIN_NAME" %}/external_api.js'></script>
<script>
var api = null;
const domain = "{% settings_value "ECONGRE_JITSI_DOMAIN_NAME" %}";
const options = {
    roomName: '{{stand.salle_discussion}}'{% if jwtToken %} + '?jwt={{jwtToken}}' {% endif %} ,
    interfaceConfigOverwrite: {
        filmStripOnly: false,
        TOOLBAR_BUTTONS: [
            'microphone', 'camera', 'closedcaptions', 'desktop', 'fullscreen',
            'fodeviceselection', 'hangup', 'profile', 'chat',
            'etherpad', 'sharedvideo', 'settings', 'raisehand',
            'videoquality', 'filmstrip', 'feedback', 'stats', 'shortcuts',
            'tileview', 'download', 'help', 'mute-everyone', 'security'
        ],
    },
    configOverwrite: {
        enableWelcomePage: false,
        startAudioOnly: false,
        defaultLanguage: 'fr'
    },
    width: '100%',
    height: '100%',
    onload: function() {
        console.log("onload");
    },
    userInfo: {
        name: '{{request.user.get_full_name}}'
    },
    parentNode: document.querySelector('#meet')
};
function openJitsiRoom() {
    $("#meet").html("");
    {% is_mobile_app request as mobile_app %}
    {% if mobile_app %}
        {% if user|is_partner %}
        Android.openJitsiActivity(domain, '{{ stand.salle_discussion }}', {% if jwtToken %}'{{ jwtToken }}'{% endif %});
        {% else %}
        Android.openJitsiActivity(domain, '{{ stand.salle_discussion }}', '');
        {% endif %}
    {% else %}
    api = new JitsiMeetExternalAPI(domain, options);
    // when local user has joined the video conference
    api.addEventListener('videoConferenceJoined', (response) => {
        api.executeCommand('displayName', '{{request.user.get_full_name}}');
    });
    api.addEventListener('participantRoleChanged', function (event) {
        if(event.role === 'moderator') {
            api.executeCommand('toggleLobby', true);
        }
    });
    {% endif %}
}

$(document).ready(function() {
    $([document.documentElement, document.body]).animate({
        scrollTop: $("#meet").offset().top
    }, 1000);
    openJitsiRoom();
});

</script>
{% endblock %}
