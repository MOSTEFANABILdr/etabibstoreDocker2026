{% extends "base3.html" %}
{% load i18n %}
{% load static %}
{% load crispy_forms_tags %}
{% load avatar_tags %}
{% block title %} {% trans "Etabib" %} {%endblock %}
{% block style %}
<!-- Google Fonts
                    ============================================ -->
<link href="https://fonts.googleapis.com/css?family=Play:400,700"
      rel="stylesheet">
<!-- Bootstrap CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/bootstrap.min.css" %}'>
<!-- Bootstrap CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/font-awesome.min.css" %}'>
<!-- animate CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/animate.css" %}'>
<!-- owl.carousel CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/owl.carousel.css" %}'>
<link rel="stylesheet" href='{% static "css/owl.theme.css" %}'>
<link rel="stylesheet" href='{% static "css/owl.transitions.css" %}'>
<!-- normalize CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/normalize.css" %}'>
<!-- forms CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/form/all-type-forms.css" %}'>
<!-- CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/directory.css" %}'>

<!-- modernizr JS
                    ============================================ -->
<script src='{% static "js/vendor/modernizr-2.8.3.min.js" %}'></script>
<style>
    input#first_last_name {
        background-color: #f8f9fa;
        color: black;
        font-weight: 600;
        text-align: center;
    }
    input#first_last_name::placeholder {
      color: black;
      text-align: center;
    }

    input#first_last_name:-ms-input-placeholder {
      color: black;
      text-align: center;
    }

    input#first_last_name::-ms-input-placeholder {
        color: black;
        text-align: center;
    }

    .select2-container--default .select2-selection--single {
        background-color: #f8f9fa!important;
    }

    .select2-selection__placeholder {
         color: black !important;
         font-weight: 600;
    }

    .panel-contact {
        border-color: #cdeefb !important;
        margin-right: 10px;
    }
    .panel-contact>.panel-heading {
        background-color: #cdeefb;
        height: 150px;
    }
    .panel-contact>.panel-body {
        min-height: 90px;
    }
    .panel-contact> .panel-footer {
        border-top: none;
        background: transparent;
    }
    .panel-contact .media .media-heading {
        color: black;
    }
    .label-light {
        background-color: #f8f9fa!important;
        color: black!important;
    }
    @media (min-width: 1270px) {
        .btn-group.btn-group.btn-group-responsive > .btn {
            margin-right: 5px;
            background-color: #f8f9fa;
        }
    }
    @media (max-width: 1270px) {
      .btn-group.btn-group-responsive > .btn {
        display: block;
        width: 100%;
        margin-bottom: 5px;
        background-color: #f8f9fa;
      }

      /* making the border-radius correct */
      .btn-group.btn-group-responsive > .btn:first-child {
        border-radius: 6px 6px 0 0;
      }
      .btn-group.btn-group-responsive > .btn:first-child:not(:last-child):not(.dropdown-toggle) {
        border-top-right-radius: 6px;
      }
      .btn-group.btn-group-responsive > .btn:last-child:not(:first-child) {
        border-radius: 0 0 6px 6px;
      }

      /* fixing margin */
      .btn-group.btn-group-responsive .btn + .btn {
        margin-left: 0;
      }

      .panel-contact>.panel-heading {
        height: 200px;
        }
    }
</style>
{% endblock %}
{% block content %}
<div class="page-wrapper">
    <!-- ******Header****** -->
    <header class="header text-center bg">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 col-md-4 col-sm-12 p-0">
                    <div class="form-group">
                        <input type="text" class="form-control center-block" id="first_last_name"
                               placeholder="{% trans 'عن اي طبيب تبحث (الاسم أو اللقب) ؟' %}" style="height:45px">
                    </div>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-12 p-0">
                    <div class="form-group">
                        {% csrf_token %}
                        {% crispy form_specialite %}
                        {{ form_specialite.media }}
                    </div>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-12 p-0">
                    <div class="form-group">
                        {% csrf_token %}
                        {% crispy form_position %}
                        {{ form_position.media }}
                    </div>
                </div>
            </div>
        </div>
    </header>
    <section class="cards-section ">
        <div class="row">
            <div id="doctors" class="container text-center endless_page_template">
                {% include page_template %}
            </div>
        </div><!--//container-->
    </section><!--//cards-section-->
</div><!--//page-wrapper-->
<div id="rdvModal" class="modal form-elegant text-center" role="dialog" >
    <div class="modal-dialog error-pagewrap" id="dmd_rdv">
        <div class="error-page-int panel-body text-center">
            <div class="hpanel ">
                <div class="panel-body text-center login-body">
                    <h2 class="form-title" style="margin-bottom: 5px;font-size:30px!important;">
                        {% trans 'لمنْ المَوعِد' %}
                    </h2>
                    <form id="firststepform">
                        <div class="form-group">
                            <p class="error" id="error-text">

                            </p>
                        </div>
                        <div class="form-group">
                            <input type="text" name="lastname" class="form-control" style="text-align:center" id="inputfirstname"
                                   placeholder="{% trans 'يرجى إدخال الإسم' %}">
                        </div>
                        <div class="form-group">
                            <input type="text"  name="firstname"  class="form-control"  style="text-align:center" class="etabib-form-control" id="inputlastname"
                                   placeholder="{% trans 'يرجى إدخال اللقب' %}">
                        </div>
                        <div class="form-group">
                            <input type="tel"  name="phone"  class="form-control"   style="text-align:center"
                                   pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}"
                                   class="etabib-form-control" id="inputphone"
                                   placeholder="{% trans 'يرجى إدخال رقم الهاتف' %}">
                        </div>
                        <label>{% trans 'أي نوع من الاستشارات تريد؟' %}</label>
                        <div class="form-group">
                            <select  class="form-control"  name="choices" id="rdv_choices">
                                <option value="1">{% trans 'En ligne' %}</option>
                                <option value="2">{% trans 'À domicile' %}</option>
                                <option value="3">{% trans 'Au cabinet' %}</option>
                            </select>
                        </div>
                        <button style="width: 135px;height: 43px;" type="submit" class="btn  btn-etabib stepone" >
                            {% trans 'التالي ' %}
                        </button>
                    </form>
                    <br>
                    <h2 class="form-title" style="margin-bottom: 20px;font-size:16px;">
                        {% trans 'إن كنت مسجلا من قبل في المنصة يرجى الدخول الى فضائك الخاص لمتابعة جميع مواعيدك' %}
                    </h2>
                    <div class="card card-body" style="text-align:center">
                        <a id="login_link" target="_blank" style="background-color:#e6faff !important;" title="{% trans 'فضاء الزبون' %}"
                           href="{{request.scheme}}://{{request.META.HTTP_HOST}}/login" class="btn btn-etabib">
                            <img width="36px" src='{% static "img/logo/logdo.png" %}'/>
                            {% trans 'فضاء الزبون' %}
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block js %}
<!-- bootstrap JS
                    ============================================ -->
<script src='{% static "js/bootstrap.min.js" %}'></script>
<!-- wow JS
                    ============================================ -->
<script src='{% static "js/wow.min.js" %}'></script>
<!-- owl.carousel JS
                    ============================================ -->
<script src='{% static "js/owl.carousel.min.js" %}'></script>
<!-- meanmenu JS
                    ============================================ -->
<script src='{% static "js/jquery.meanmenu.js" %}'></script>
<!-- scrollUp JS
                    ============================================ -->
<script src='{% static "js/jquery.scrollUp.min.js" %}'></script>
<!-- mCustomScrollbar JS
                    ============================================ -->
<script src='{% static "js/scrollbar/jquery.mCustomScrollbar.concat.min.js" %}'></script>
<script src='{% static "js/scrollbar/mCustomScrollbar-active.js" %}'></script>
<!-- tab JS
                    ============================================ -->
<script src='{% static "js/tab.js" %}'></script>
<!-- endless pagination JS ============================================ -->
<script src='{% static "el-pagination/js/el-pagination.js" %}'></script>
<script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>
<script>
$(function () {
	$.endlessPaginate({});
    var specialite;
    document.querySelector('select[name="specialite"]').onchange=function() {
        specialite = $(this).val();
    }
    var position;
    document.querySelector('select[name="position"]').onchange=function() {
        position = $(this).val();
    }

     function searchDoctor() {
	    first_last_name = $('#first_last_name').val();
	    //clearing detail
        $('#doctors').html("");
        //showing spinner
        $("#doctors").html("<div class='text-center'><i class='fa fa-spinner fa-spin fa-2x dark-blue'></i></div>")
        //loading list
        $('#doctors').load('{% url 'directory' %}', {
		    'search': "true",
		    'first_last_name': first_last_name,
		    'position': position,
		    'specialite': specialite,
		    'csrfmiddlewaretoken': '{{csrf_token}}'
		    },
            function() {
            }
        );
    };

    $( "#first_last_name" ).keyup(function() {
        searchDoctor();
    });

    $(document.body).on("change", "#id_specialite", function(){
        searchDoctor();
    });
    $(document.body).on("change", "#id_position" , function(){
        searchDoctor();
    });


    var contact_id = null;

    $(document).on('click', '.sub', function(){
        contact_id = $(this).data("doc");
    });

    $("#firststepform").submit(function(e){
        e.preventDefault();

        var firstname =$('#inputfirstname').val();
        var lastname =$('#inputlastname').val();
        var phone =$('#inputphone').val();
        var choice = $("#rdv_choices").val();
        if(firstname && lastname && phone){
            $('#dmd_rdv').load('{% url 'signup-directory' %}', {
                'contact':contact_id ,
                'choice': choice,
		        'inputfirstname': firstname,
		        'inputlastname': lastname,
		        'inputphone': phone,
		        'csrfmiddlewaretoken': '{{csrf_token}}'
		        },
                function() {
                }
            );
        } else {
            $("#error-text").html("{% trans 'يُرجى تعبئة كل البيانات' %}");
        }
    });

    //jquery validate
    $.validator.addMethod('customphone', function (value, element) {
        return !this.optional(element) || /^(\+[0-9]{2,3}-?0?|0)?\d{9}$/.test(value);
    }, "Please enter a valid phone number");
    $.validator.setDefaults({
        debug: true,
        success: "valid"
    });
    $( "#firststepform" ).validate({
        errorElement: 'p',
        errorClass: 'error',
        rules: {
            lastname: {
              required: true,
            },
            firstname: {
              required: true,
            },
            phone: "customphone"
        }
    });

    //modal
    $('#rdvModal').on('show.bs.modal', function(e) {
        //get data-id attribute of the clicked element
        var chash = $(e.relatedTarget).data('hash');
        $("#login_link").attr("href", "{{request.scheme}}://{{request.META.HTTP_HOST}}/patient/profile?rdvc=" + chash);
    });

});

</script>
{% endblock %}