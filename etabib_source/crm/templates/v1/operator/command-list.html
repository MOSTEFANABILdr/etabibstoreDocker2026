{% extends "base.html" %}
{% load i18n %}
{% load static %}
{% load role_tags %}
{% block title %} {% trans 'Commande list' %} {% endblock %}
{% block style %}
<!-- Google Fonts
                    ============================================ -->
<link
        href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,700,900"
        rel="stylesheet">
<!-- Bootstrap CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/bootstrap.min.css" %}'>
<!-- Bootstrap CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/font-awesome.min.css" %}'>
<!-- animate CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/animate.css" %}'>
<!-- normalize CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/normalize.css" %}'>
<!-- meanmenu icon CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/meanmenu.min.css" %}'>
<!-- main CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/main.css" %}'>
<!-- mCustomScrollbar CSS
                    ============================================ -->
<link rel="stylesheet"
      href='{% static "css/scrollbar/jquery.mCustomScrollbar.min.css" %}'>
<!-- metisMenu CSS
                    ============================================ -->
<link rel="stylesheet"
      href='{% static "css/metisMenu/metisMenu.min.css" %}'>
<link rel="stylesheet"
      href='{% static "css/metisMenu/metisMenu-vertical.css" %}'>
<!-- modernizr JS ============================================ -->
<script src='{% static "js/vendor/modernizr-2.8.3.min.js" %}'></script>
<!-- jquery.dataTables CSS ============================================ -->
<link href="{% static 'ajax_datatable/css/style.css' %}" rel="stylesheet"/>
<link href="{% static 'v2/plugins/datatables.net-bs4/css/dataTables.bootstrap4.min.css' %}" rel="stylesheet"/>
<link href="{% static 'v2/plugins/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css' %}"
      rel="stylesheet"/>
<style>
    @media only screen and (max-width: 600px) {
      div.dataTables_wrapper div.dataTables_filter input {
        width: 100px;
      }
    }
</style>

{% endblock %}
{% block content %}
<div class="single-pro-review-area mt-t-30 mg-b-15">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="product-payment-inner-st">
                    <h3>{% trans 'Listes des commandes' %}</h3>
                    <br>
                    {% if messages %}
                    <div class="row">
                        <ul>
                            {% for message in messages %}
                            <div class="alert alert-{{ message.tags }}">
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                                <p>{{message}}</p>
                            </div>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                    <button id="genratebr_btn" class="btn btn-etabib disabled" onclick="generate_bordereau(this)">
                        {% trans 'Générer un Bordereau' %}
                    </button>
                    <br>
                    <br>
                    <div id="myTabContent" class="tab-content custom-product-edit">
                        <div class="product-tab-list tab-pane fade active in" id="description">
                            <div class="">
                                <table id="datatable_commandes" width="100%"
                                       class="table table-striped table-bordered table-td-valign-middle dt-responsive">
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block js %}
<!-- dataTables ============================================ -->
<script type="text/javascript" src="{% static 'ajax_datatable/js/utils.js' %}?v=0.64"></script>
<script src="{% static 'v2/plugins/datatables.net/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'v2/plugins/datatables.net-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
<script src="{% static 'v2/plugins/datatables.net-responsive/js/dataTables.responsive.min.js' %}"></script>
<script src="{% static 'v2/plugins/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js' %}"></script>
<!-- bootstrap JS ============================================ -->
<script src='{% static "js/bootstrap.min.js" %}'></script>
<!-- wow JS ============================================ -->
<script src='{% static "js/wow.min.js" %}'></script>
<!-- meanmenu JS
                    ============================================ -->
<script src='{% static "js/jquery.meanmenu.js" %}'></script>
<!-- sticky JS ============================================ -->
<script src='{% static "js/jquery.sticky.js" %}'></script>
<!-- scrollUp JS ============================================ -->
<script src='{% static "js/jquery.scrollUp.min.js" %}'></script>
<!-- mCustomScrollbar JS ============================================ -->
<script src='{% static "js/scrollbar/jquery.mCustomScrollbar.concat.min.js" %}'></script>
<script src='{% static "js/scrollbar/mCustomScrollbar-active.js" %}'></script>
<!-- metisMenu JS  ============================================ -->
<script src='{% static "js/metisMenu/metisMenu.min.js" %}'></script>
<script src='{% static "js/metisMenu/metisMenu-active.js" %}'></script>
<!-- plugins JS  ============================================ -->
<script src='{% static "js/plugins.js" %}'></script>
<!-- main JS ============================================ -->
<script src='{% static "js/main.js" %}'></script>
<!-- tawk chat JS  ============================================ -->
{% include 'partial/tawk-script.html' %}
<script>
    function onCheck(element) {
        // If the checkbox is checked, display the output text
        if ($('input[name=commande_checkbox]:checked').length > 0){
            $("#genratebr_btn").removeClass("disabled");
        } else {
            $("#genratebr_btn").addClass("disabled");
        }
    }
    function generate_bordereau(element) {
        var arr = [];
        $("input:checkbox[name=commande_checkbox]:checked").each(function(){
            arr.push($(this).val());
        });
        $(element).prepend("<i class='fa fa-spinner fa-spin'></i>");
        $(element).prop('disabled', true);
        var data = {
            commands: arr
        };

        $.post("{% url 'generate_bordereau' %}", data, function(data, status){
            $(element).find("i").remove();
            $(element).prop('disabled', false);
            window.location = "{% url 'bordereau_list' %}";
         });
    }
    $(document).ready(function() {
        AjaxDatatableViewUtils.initialize_table(
            $('#datatable_commandes'),
            "{% url 'commande_ajax' %}",
            {
                processing: true,
                autoWidth: false,
                scrollX: false,
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/1.10.21/i18n/French.json"
                },
                responsive: true
            }
        )
    });
</script>
{% endblock %}