{% extends "base.html" %}
{% load i18n %}
{% load static %}
{% load avatar_tags %}
{% load crispy_forms_tags %}
{% block title %} {% trans 'Crée Facture HT' %} {% endblock %}
{% block style %}
<!-- Google Fonts
                    ============================================ -->
<link
        href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,700,900" rel="stylesheet">
<!-- Bootstrap CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/bootstrap.min.css" %}'>
<!-- Bootstrap CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/font-awesome.min.css" %}'>
<!-- owl.carousel CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/owl.carousel.css" %}'>
<link rel="stylesheet" href='{% static "css/owl.theme.css" %}'>
<link rel="stylesheet" href='{% static "css/owl.transitions.css" %}'>
<!-- animate CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/animate.css" %}'>
<!-- normalize CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/normalize.css" %}'>
<!-- meanmenu icon CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/meanmenu.min.css" %}'>
<!-- main CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/main.css" %}'>
<!-- educate icon CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/educate-custon-icon.css" %}'>
<!-- morrisjs CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/morrisjs/morris.css" %}'>
<!-- mCustomScrollbar CSS
                    ============================================ -->
<link rel="stylesheet"
      href='{% static "css/scrollbar/jquery.mCustomScrollbar.min.css" %}'>
<!-- metisMenu CSS
                    ============================================ -->
<link rel="stylesheet"
      href='{% static "css/metisMenu/metisMenu.min.css" %}'>
<link rel="stylesheet"
      href='{% static "css/metisMenu/metisMenu-vertical.css" %}'>
<!-- cropper CSS ============================================ -->
<link rel="stylesheet" href='https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.6/cropper.min.css'>
<!-- modernizr JS ============================================ -->
<script src='{% static "js/vendor/modernizr-2.8.3.min.js" %}'></script>
<!-- filepond css ============================================ -->
<link href="https://unpkg.com/filepond/dist/filepond.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/filepond-plugin-get-file@1.0.3/dist/filepond-plugin-get-file.min.css"
      rel="stylesheet">
{% endblock %}
{% block content %}
<div class="single-pro-review-area mt-t-30 mg-b-15">
    <div class="container-fluid">
        <div class="card white-ter">
            <form class="" method="POST" action="">{% csrf_token %}
                <h2>{% trans 'Facture' %}</h2>
                <div class="row">
                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                        <label>{% trans 'Client' %}:</label>
                        {{form.first_last_name}}
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                        <label>{% trans 'Numéro de commande' %}:</label>
                        {{form.numero_commande}}
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <label>{% trans 'Adresse' %}:</label>
                        {{form.adresse}}
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                        <label>{% trans 'R / C' %}:</label>
                        {{form.numero_registre_commerce}}
                    </div>
                    <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                        <label>{% trans 'NIF' %}:</label>
                        {{form.numero_identification_fiscale}}
                    </div>
                    <div class="col-lg-3 col-md-4 col-sm-12 col-xs-12">
                        <label>{% trans 'NIC' %}:</label>
                        {{form.numero_identification_domaine}}
                    </div>
                    <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                        <label>{% trans 'TIN' %}:</label>
                        {{form.numero_tin}}
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                        <label>{% trans 'Téléphone' %}:</label>
                        {{form.numeros_telephone}}
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                        <label>{% trans 'MAIL' %}:</label>
                        {{form.adresse_electronique}}
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                        <label>{% trans 'FAX' %}:</label>
                        {{form.numeros_fax}}
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                        <label>{% trans 'Numéro article' %}:</label>
                        {{form.numero_article}}
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                        <label>{% trans 'Statut' %}:</label>
                        {{form.statut}}
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                        <label>{% trans 'Date limite reglement' %}:</label>
                        <br>
                        {{form.date_limite_reglement}}
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                        <label>{% trans 'Mode de paiement' %}:</label>
                        {{form.mode_de_paiement}}
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                        <label>{% trans 'REMISES ET RABAIS' %}:</label>
                        {{form.remises_et_rabais}}
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                        <label>{% trans 'FRAIS DE LIVRAISON' %}:</label>
                        {{form.frais_de_livraison}}
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                        <label>{% trans 'TIMBRE' %}:</label>
                        {{form.timbre}}
                    </div>
                </div>
                <br>
                <h2>{% trans 'Detail Facture' %}</h2>
                <table class="table table-responsive">
                    <tbody>
                    <thead>
                    <tr>
                        <th>{% trans 'Product/Service' %}</th>
                        <th>{% trans 'QTY' %}</th>
                        <th>{% trans 'Prix HT' %}</th>
                        <th>{% trans 'Tva' %} %</th>
                        <th>{% trans 'MONTATANT TTC' %}</th>
                    </tr>
                    {{ formset.management_form }}
                    {% for form in formset %}
                    <tr>
                        <td>{{form.designation}}</td>
                        <td>{{form.quantity}}</td>
                        <td>{{form.montant}}</td>
                        <td>{{form.tva}}</td>
                        <td class="amount"></td>
                        <td>
                            <div class="input-group-append">
                                <button
                                        class="button is-small btn btn-success add-form-row">+
                                </button>&nbsp;
                                <!-- <button class="button is-small btn btn-warning remove-form-row">-</button> -->
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                    </thead>
                    </tbody>
                </table>
                <div class="columns">
                    <div class="column">
                        <h3 class="title is-4">Total: <span id="total"></span></h3>
                    </div>
                </div>
                <br>
                <div class="columns">
                    <button type="submit" class="btn btn-success">{% trans 'Créer' %}</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
{% block js %}
<!-- bootstrap JS
                    ============================================ -->
<script src='{% static "js/bootstrap.min.js" %}'></script>
<!-- wow JS
                    ============================================ -->
<script src='{% static "js/wow.min.js" %}'></script>
<!-- price-slider JS
                    ============================================ -->
<script src='{% static "js/jquery-price-slider.js" %}'></script>
<!-- meanmenu JS
                    ============================================ -->
<script src='{% static "js/jquery.meanmenu.js" %}'></script>
<!-- owl.carousel JS
                    ============================================ -->
<script src='{% static "js/owl.carousel.min.js" %}'></script>
<!-- sticky JS  ============================================ -->
<script src='{% static "js/jquery.sticky.js" %}'></script>
<!-- scrollUp JS ============================================ -->
<script src='{% static "js/jquery.scrollUp.min.js" %}'></script>
<!-- Cropper JS ============================================ -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.6/cropper.min.js'></script>
<script src='{% static "js/cropper/jquery-cropper.min.js" %}'></script>
<!-- mCustomScrollbar JS ============================================ -->
<script src='{% static "js/scrollbar/jquery.mCustomScrollbar.concat.min.js" %}'></script>
<script src='{% static "js/scrollbar/mCustomScrollbar-active.js" %}'></script>
<!-- metisMenu JS ============================================ -->
<script src='{% static "js/metisMenu/metisMenu.min.js" %}'></script>
<script src='{% static "js/metisMenu/metisMenu-active.js" %}'></script>
<!-- plugins JS
                    ============================================ -->
<script src='{% static "js/plugins.js" %}'></script>
<!-- main JS  ============================================ -->
<script src='{% static "js/main.js" %}'></script>
<!-- filepond JS ============================================ -->
<script src="https://unpkg.com/filepond/dist/filepond.js"></script>
<!-- include FilePond plugins -->
<script src="https://unpkg.com/filepond-plugin-file-validate-size/dist/filepond-plugin-file-validate-size.js"></script>
<script src="https://cdn.jsdelivr.net/npm/filepond-plugin-get-file@1.0.3/dist/filepond-plugin-get-file.min.js"></script>
<!-- include FilePond jQuery adapter -->
<script src="https://unpkg.com/jquery-filepond/filepond.jquery.js"></script>
<!-- tawk chat JS
                    ============================================ -->
{% include 'partial/tawk-script.html' %}

<script type="text/javascript">
    $('table input').on("input", function () {
        var total = []
        var $tr = $(this).closest('tr');
        var qty = $("input.quantity", $tr).val();
        var montant = $('input.montant', $tr).val();
        var tva = $('input.tva', $tr).val();
        amt =montant * (1 + tva / 100) * qty;
        $('.amount', $tr).html(amt);
        calc_total();
    });
    $('#id_remises_et_rabais').on("input", function () {
        calc_total();
    });
    $('#id_frais_de_livraison').on("input", function () {
        calc_total();
    });
    $('#id_timbre').on("input", function () {
        calc_total();
    });
    function calc_total() {
        var sum = 0;
        var remise =  document.getElementById('id_remises_et_rabais').value;
        var livraison =  document.getElementById('id_frais_de_livraison').value;
        var timbre =  document.getElementById('id_timbre').value;
        $(".amount").each(function () {
            sum += parseFloat($(this).text());
        });
        sum = sum - parseFloat(remise) + parseFloat(livraison) + parseFloat(timbre)
        $('#total').text(sum);
    }
</script>
<script type="text/javascript">
    function updateElementIndex(el, prefix, ndx) {
        var id_regex = new RegExp('(' + prefix + '-\\d+)');
        var replacement = prefix + '-' + ndx;
        if ($(el).attr("for")) $(el).attr("for", $(el).attr("for").replace(id_regex, replacement));
        if (el.id) el.id = el.id.replace(id_regex, replacement);
        if (el.name) el.name = el.name.replace(id_regex, replacement);
    }
    function cloneMore(selector, prefix) {
        var newElement = $(selector).clone(true);
        console.log(newElement);
        var total = $('#id_' + prefix + '-TOTAL_FORMS').val();
        newElement.find(':input:not([type=button]):not([type=submit]):not([type=reset])').each(function () {
            var name = $(this).attr('name')
            if (name) {
                name = name.replace('-' + (total - 1) + '-', '-' + total + '-');
                var id = 'id_' + name;
                $(this).attr({ 'name': name, 'id': id }).val('').removeAttr('checked');
            }
        });
        newElement.find('label').each(function () {
            var forValue = $(this).attr('for');
            if (forValue) {
                forValue = forValue.replace('-' + (total - 1) + '-', '-' + total + '-');
                $(this).attr({ 'for': forValue });
            }
        });
        total++;
        $('#id_' + prefix + '-TOTAL_FORMS').val(total);
        $(selector).after(newElement);
        return false;
    }
    function deleteForm(prefix, btn) {
        var total = parseInt($('#id_' + prefix + '-TOTAL_FORMS').val());
        if (total > 1) {
            btn.closest('.form-row').remove();
            var forms = $('.form-row');
            $('#id_' + prefix + '-TOTAL_FORMS').val(forms.length);
            for (var i = 0, formCount = forms.length; i < formCount; i++) {
                $(forms.get(i)).find(':input').each(function () {
                    updateElementIndex(this, prefix, i);
                });
            }
        }
        return false;
    }
    $(document).on('click', '.add-form-row', function (e) {
        e.preventDefault();
        cloneMore('table tr:last', 'form');
        return false;
    });
    $(document).on('click', '.remove-form-row', function (e) {
        e.preventDefault();
        deleteForm('form', $(this));
        return false;
    });




</script>
{% endblock %}