{% extends "base.html" %}
{% load i18n %}
{% load static %}
{% block title %} Blank {% endblock %}
{% block style %}
<!-- Google Fonts
                    ============================================ -->
<link
        href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,700,900"
        rel="stylesheet">
<!-- Bootstrap CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/bootstrap.min.css" %}'>
<!-- Bootstrap CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/font-awesome.min.css" %}'>
<!-- owl.carousel CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/owl.carousel.css" %}'>
<link rel="stylesheet" href='{% static "css/owl.theme.css" %}'>
<link rel="stylesheet" href='{% static "css/owl.transitions.css" %}'>
<!-- animate CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/animate.css" %}'>
<!-- normalize CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/normalize.css" %}'>
<!-- meanmenu icon CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/meanmenu.min.css" %}'>
<!-- main CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/main.css" %}'>
<!-- educate icon CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/educate-custon-icon.css" %}'>
<!-- mCustomScrollbar CSS
                    ============================================ -->
<link rel="stylesheet"
      href='{% static "css/scrollbar/jquery.mCustomScrollbar.min.css" %}'>
<!-- metisMenu CSS
                    ============================================ -->
<link rel="stylesheet"
      href='{% static "css/metisMenu/metisMenu.min.css" %}'>
<link rel="stylesheet"
      href='{% static "css/metisMenu/metisMenu-vertical.css" %}'>
<!-- modernizr JS
                    ============================================ -->
<script src='{% static "js/vendor/modernizr-2.8.3.min.js" %}'></script>
{% endblock %}
{% block content %}
{% load carton_tags %}
<div class="single-pro-review-area mt-t-30 mg-b-15">
    <div class="container-fluid">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <h1>Panier</h1>
            {% get_cart as cart %}
            {% if cart.items %}
            <table class="table">
                <thead>
                    <tr>
                        <th>{% trans 'Module' %}</th>
                        <th>{% trans 'Consomation' %}</th>
                        <th>{% trans 'Poste' %}</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in cart.items %}
                    <tr>
                        <td>
                            <a href="{% url 'etabib-store-item' item.product.pk item.product.slug %}">{{ item.product }}</a>
                        </td>
                        <td>
                            {{item.product.consomation}}/
                            <small>{{item.product.get_type_consomation_display|lower}}</small>
                        </td>
                        <td>{{ item.poste.libelle }}</td>
                        <td>
                            <button class="btn btn-danger"
                                    onclick="deleteItemFromCart({{item.product.pk}}, {{item.poste.pk}}, this)">
                                <i class="fa fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr >
                        <td colspan="4">
                            <button id="validate" class="btn btn-etabib">Valider</button>
                        </td>
                    </tr>
                </tfoot>
            </table>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
{% block js %}
<!-- bootstrap JS
                    ============================================ -->
<script src='{% static "js/bootstrap.min.js" %}'></script>
<!-- wow JS
                    ============================================ -->
<script src='{% static "js/wow.min.js" %}'></script>
<!-- price-slider JS
                    ============================================ -->
<script src='{% static "js/jquery-price-slider.js" %}'></script>
<!-- meanmenu JS
                    ============================================ -->
<script src='{% static "js/jquery.meanmenu.js" %}'></script>
<!-- owl.carousel JS
                    ============================================ -->
<script src='{% static "js/owl.carousel.min.js" %}'></script>
<!-- sticky JS
                    ============================================ -->
<script src='{% static "js/jquery.sticky.js" %}'></script>
<!-- scrollUp JS
                    ============================================ -->
<script src='{% static "js/jquery.scrollUp.min.js" %}'></script>
<!-- mCustomScrollbar JS
                    ============================================ -->
<script
        src='{% static "js/scrollbar/jquery.mCustomScrollbar.concat.min.js" %}'></script>
<script src='{% static "js/scrollbar/mCustomScrollbar-active.js" %}'></script>
<!-- metisMenu JS
                    ============================================ -->
<script src='{% static "js/metisMenu/metisMenu.min.js" %}'></script>
<script src='{% static "js/metisMenu/metisMenu-active.js" %}'></script>
<!-- plugins JS
                    ============================================ -->
<script src='{% static "js/plugins.js" %}'></script>
<!-- main JS
                    ============================================ -->
<script src='{% static "js/main.js" %}'></script>
<!-- tawk chat JS
                    ============================================ -->
{% include 'partial/tawk-script.html' %}
<script>
function deleteItemFromCart(pk_module, pk_poste,  element) {
    var data = {
        'pk_module' : pk_module,
        'pk_poste' : pk_poste,
        'csrfmiddlewaretoken': '{{ csrf_token }}'
    }
    $.post("{% url 'shopping-cart-remove' %}", data, function( response ) {
        $(element).parent().parent().remove();
    });
}
$(document).ready(function() {
    //processing installation
    $("#validate").click(function(event) {
        event.preventDefault();
        var element = $(this);
        $(element).append(' <i class="fa fa-spinner fa-spin"></i>');
        var data = {
                     'csrfmiddlewaretoken': '{{ csrf_token }}'
                   };
       $.post( "{% url 'shopping-cart-validate' %}", data, function(response) {
         $(element).find("i").remove();
         $('.table').remove();
         Lobibox.notify('success', {
             size: 'mini',
             position: 'top right',
             sound: false,
             msg: response.success_message
         });
       })
      .fail(function(response) {
         //TODO: Change msg text
         $(element).find("i").remove();
         Lobibox.notify('error', {
             size: 'mini',
             position: 'top right',
             sound: false,
             msg: 'Erreur Interne du Serveur'
         });
      });
    });
});

</script>
{% endblock %}
