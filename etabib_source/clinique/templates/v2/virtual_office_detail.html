{% extends "base.html" %}
{% load i18n static embed_video_tags teleconsultation_tags avatar_tags utils_tags %}

{% block title %} {{clinique.titre}} {% endblock %}

{% block style %}
 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
   integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
   crossorigin=""/>
<style>
    .opmap {
        height: 400px;
        width: 100%;
      }
</style>
{% endblock %}
{% block content %}
{% include 'partial/virtual_office_header.html' %}
<div class="container">
    <div class="row">
        <div class="col-xl-6">
            <div class="panel" data-sortable="false">
                <div class="panel-heading">
                    <h4 class="panel-title f-s-25"></h4>
                </div>
                <div class="panel-body">
                    <div id="video-container">
                        {% if clinique.video1 %}
                        {% video clinique.video '100%x400' %}
                        {% else %}
                        <iframe width="100%" height="400" src="https://www.youtube.com/embed/adjNhBIJsd4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        {% endif %}
                    </div>
                    <a class="btn btn-block btn-lg btn-etabib pr-4 visio-enter">
                        {% trans 'تحدث مع عون الإستقبال' %}
                        <img height="30px" class="pull-right" src="{% static 'v2/icons/rounded/9.svg' %}">
                        <span id="bubble" class="bubble {{ clinique_status }}"
                              style="display: inline;margin-left:10px;margin-top:5px;" title="">
                            <span class="bubble-outer-dot">
                                <span class="bubble-inner-dot"></span>
                            </span>
                        </span>
                    </a>
                    <a href="{% url 'virtual-office-tarifs' clinique.id %}" class="btn btn-block btn-lg btn-etabib pr-4">
                        {% trans 'قائمة الخدمات والتسعيرات' %}
                        <img height="30px" class="pull-right" src="{% static 'v2/icons/rounded/11.svg' %}">
                    </a>
                    <a href="{% url 'doctor-profile-detail' clinique.user.medecin.contact.id %}" class="btn btn-block btn-lg btn-etabib pr-4">
                        <img height="30px" class="pull-right" src="{% static 'v2/icons/rounded/7.svg' %}">
                        {% trans 'حجز المواعيد مع أطباء العيادة' %}
                    </a>
                </div>
            </div>
        </div>
        <div class="col-lg-6 col-md-6 col-sm-12">
            <!-- begin panel -->
            <div class="panel" data-sortable="false">
                <div class="panel-heading text-right">
                    <h4 class="panel-title f-s-25">{% trans 'التعريف بالعيادة' %}</h4>
                </div>
                <div class="panel-body voffice-body">
                    <!-- begin table -->
                    <div class="table-responsive">
                        <table class="table table-borderless">
                            <tbody>
                            <tr>
                                <td class="field">{% trans 'Titre' %}</td>
                                <td>
                                    <label>
                                        {{clinique.titre|default_if_none:""}}
                                    </label>
                                </td>
                            </tr>
                            <tr>
                                <td class="field">{% trans 'Description' %}</td>
                                <td>
                                    <label>
                                        {{clinique.description|default_if_none:""}}
                                    </label>
                                </td>
                            </tr>
                            <tr>
                                <td class="field">{% trans 'Pays' %}</td>
                                <td>
                                    <label>
                                        {{clinique.pays|default_if_none:""}}
                                    </label>
                                </td>
                            </tr>
                            <tr>
                                <td class="field">{% trans 'Ville' %}</td>
                                <td>
                                    <label>
                                        {{clinique.ville.name|default_if_none:""}}
                                    </label>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- end table -->
                </div>
            </div>
            <!-- end panel -->
            <div class="row">
                <div class="col-md-6">
                    <div class="panel" data-sortable="false">
                        <div class="panel-heading">
                            <h4 class="panel-title f-s-25 text-right">{% trans 'معلومات الإتصال' %}</h4>
                        </div>
                        <div class="panel-body">
                            <p>
                                <i class="fa fa-phone f-s-30 p-r-10"></i>
                                <span class="f-s-30">{{clinique.fixe|default_if_none:""}}</span>
                            </p>
                            <p>
                                <i class="fa fa-mobile f-s-30 p-r-10"></i>
                                <span class="f-s-30">{{clinique.fixe|default_if_none:""}}</span>
                            </p>
                            <p class="text-center">
                                <a class="text-decoration-none text-dark" href="{{clinique.facebook|default_if_none:'#'}}">
                                    <i class="fab f-s-30 fa-facebook m-r-20"></i>
                                </a>
                                <a class="text-decoration-none text-dark" href="{{clinique.fixe|default_if_none:'#'}}">
                                    <i class="fa fa-globe f-s-30 m-r-20"></i>
                                </a>
                                <a class="text-decoration-none text-dark" href="{{clinique.instagram|default_if_none:'#'}}">
                                    <i class="fab fa-instagram f-s-30 m-r-20"></i>
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="panel" data-sortable="false">
                        <div class="panel-heading">
                            <h4 class="panel-title f-s-25 ">{% trans 'الموقع' %}</h4>
                        </div>
                        <div class="panel-body">
                            {% if clinique.gps %}
                            <div id="opmap" class="opmap"></div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block js %}
<script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
   integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
   crossorigin=""></script>

{% if clinique.gps %}
<script type="text/javascript">
    var map = L.map('opmap', {
        center: [{{clinique.gps}}],
        zoom: 12
    });
    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
</script>
{% endif %}

<script type="text/javascript">
    $(document).ready(function(){
        setInterval(function(){clinique_visio_status();}, 10000);
        $(document).on('click', '.visio-enter',function(e) {
            e.preventDefault();
            var d = {
                "clinique_id": {{clinique.id}},
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            };
            var element = $(this);
            element.find("img").addClass("fa-spin");
            $.post( "{% url 'v-secretary-visio' %}", d)
              .done(function( data ) {
                window.open(data.url, '_blank');
                element.find("img").removeClass("fa-spin");
            }).fail(function() {
                element.find("img").removeClass("fa-spin");
                Lobibox.notify('warning', {
                    size: 'mini',
                    position: "top center",
                    msg: "{% trans "Le secretariat est en ce moment hors-ligne. Veuillez réessayer plus tard." %}"
                });
            });
        });
    });

    function clinique_visio_status() {
        var data = {
            "clinique_id": {{clinique.id}},
            'csrfmiddlewaretoken': '{{ csrf_token }}'
        };
        $.ajax({
            type: "POST",
            url: "{% url 'v-secretary-status' %}",
            data: data,
            success: function (response) {
            },
            statusCode: {
                200: function() {
                   $("#bubble").removeClass("offline").addClass("online");
                },
                204: function() {
                   $("#bubble").removeClass("online").addClass("offline");
                },
            },
            error: function (e) {
                $("#bubble").removeClass("online").addClass("offline");
            }
        });
    }
</script>
{% endblock %}

