{% load i18n role_tags utils_tags %}
<div class="container-fluid">
    {% if success == True %}
    <div class="alert alert-success">
        <strong>Succès de l'opération! </strong>
        Vous avez rechargé <a href="#" class="alert-link">{{ montant }}</a> d.a
    </div>
    {% endif %}
    {% if success == False %}
    <div class="alert alert-danger">
        <strong>Echèc de l'opération! </strong>
        Un problème est survenu lors de l'opération <strong>({{ msg }})</strong>. <a href="#" class="alert-link">Veuillez
        réessayer</a>.
    </div>
    {% endif %}
    <div class="row">
        <div class="col-lg-12">
            {% include 'partial/messages-alerts.html' %}
        </div>
    </div>
    <form method="post" class="post-form">
        {% csrf_token %}
        <div class="row">
            <div class="col-lg-4 col-md-12 col-sm-12 col-xs-12">
                <div class="white-box text-center">
                    <h3 class="box-title bg-blue-etabib dark-blue pd-10">1-أولا</h3>
                    {% if not hide_montant_select %}
                    <h4>إختر المبلغ الذي تريد تعبئته</h4>
                    {{form.montant_select}}
                    {% endif %}

                    {% if not hide_montant_select %}
                    <h4>أو أكتب المبلغ الذي تريد تعبئته</h4>
                    {% else %}
                    <h4>المبلغ</h4>
                    {% endif %}
                    {{form.montant}}

                </div>
            </div>
            <div class="col-lg-4 col-md-12 col-sm-12 col-xs-12">
                <div class="white-box text-center">
                    <h3 class="box-title bg-blue-etabib dark-blue pd-10">2-ثانيا</h3>
                    <ul class="basic-list">
                        <h4>أوافق على شروط الإستخدام
                        </h4>
                        <p>
                            <a href="#" id="read-la">الشروط</a>
                        </p>
                        {{ form.agree }}
                    </ul>
                </div>
            </div>
            <div class="col-lg-4 col-md-12 col-sm-12 col-xs-12">
                <div class="white-box text-center">
                    <h3 class="box-title bg-blue-etabib dark-blue pd-10">3-ثالثا</h3>
                    <ul>
                        <li>
                            <h4>إختر طريقة الدفع</h4>
                        </li>
                        <li>
                            {{form.mode_paiement}}
                        </li>
                        <li>
                            <h4>أدخل الرمز الظـاهر في الصورة</h4>
                        </li>
                        <li>
                            {{form.captcha}}
                        </li>
                        <li>
                            <input type="button" value="تعبئة الرصيد"
                                   class="btn btn-primary btn btn-etabib" id="submit-btn">
                            <button type="submit" class="hide"></button>
                        </li>
                    </ul>
                </div>
            </div>

        </div>
    </form>
</div>
<script>
$(document).ready(function(){
    $('input').iCheck({
        checkboxClass: 'icheckbox_square-green',
        radioClass: 'iradio_square-green',
        increaseArea: '20%' // optional
    });

    $("input[name='montant_select']").on('ifChecked',function(e){
        $('#id_montant').prop("value", "");
        $('#id_montant').prop("required", false);
        $(this).prop("required",true);
    });

    $("#id_montant").keypress(function(){
        $("input[name='montant_select']").iCheck('uncheck');
        $("input[name='montant_select']").prop("required", false);
        $(this).prop("required",true);
    });

    $("#id_montant").click(function(){
        $("input[name='montant_select']").iCheck('uncheck');
    });

    $('#submit-btn').on('click', function(e){
        e.preventDefault();
        //show confirmation notification
        var lobibox = Lobibox.confirm({
            title: "{% trans 'تأكيد' %}",
            iconClass: false,
            buttons: {
                yes: {
                    closeOnClick: true,
                    'class': 'btn btn-etabib',
                    text: "{% trans 'تأكيد العملية' %} <i class='fa fa-check fa-2x'></i>"
                },
                no: {
                    closeOnClick: true,
                    'class': 'btn btn-etabib font-weight-bold',
                    text: "{% trans 'تعديل المعلومات' %} <i class='fa fa-remove fa-2x'></i>"
                },
            },
            closable: false,
            msg: "{% trans 'سنقوم بتحويلك إلى فضاء التعبئة' %}",
            callback: function($this, type, ev) {
                if (type === 'yes') {
                     $('.post-form').find('[type="submit"]').trigger('click');
                }
            }
        });
     });

    $('#read-la').on('click', function(e){
        {% if user|is_patient %}
        var content = "{% settings_value 'TOS_PATIENT' %}";
        {% else %}
        var content = "{% settings_value 'TOS_DOCTOR' %}";
        {% endif %}
        Lobibox.window({
            title: "Les conditions d'utilisation",
            width: $(window).width(),
            content: '<iframe width="100%" height="500px" src=' + content + '></iframe>'
            });
    })

    //Prevent users from submitting a form by hitting Enter
    $(window).keydown(function(event){
        if(event.keyCode == 13) {
          event.preventDefault();
          return false;
        }
    });
});

</script>