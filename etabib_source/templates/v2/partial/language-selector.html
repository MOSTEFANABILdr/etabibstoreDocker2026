{% load i18n utils_tags %}
{% random_int 1 100000 as randint %}
<form id="language-form-{{randint}}" action="{% url 'set_language' %}" method="post">{% csrf_token %}
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/0.8.2/css/flag-icon.min.css"
          rel="stylesheet"/>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta2/dist/css/bootstrap-select.min.css">

    <input name="next" type="hidden" value="">
    {% get_current_language as LANGUAGE_CODE %}
    {% get_available_languages as LANGUAGES %}
    {% get_language_info_list for LANGUAGES as languages %}
    <select name="language" class="langselectpicker{{randint}}" data-width="60px">
        {% for language in languages %}
        <option value="{{language.code}}"
                {% if language.code == LANGUAGE_CODE %} selected{% endif %}>
                {{ language.code|upper }}
        </option>
        {% endfor %}
    </select>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta2/dist/js/bootstrap-select.min.js"></script>
    <script>
        $(function(){
            $.fn.selectpicker.Constructor.BootstrapVersion = '4';
            $('.langselectpicker{{randint}}').selectpicker({
                showIcon: true
            });
            $('.langselectpicker{{randint}}').change(function(e) {
                $("#language-form-{{randint}}").submit();
            });
        });

    </script>
</form>