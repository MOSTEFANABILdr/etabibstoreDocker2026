{% extends "base.html" %}
{% load i18n %}
{% load static %}
{% load notif_tags %}
{% block title %} {% trans 'Notifications list' %}  {% endblock %}
{% block style %}
<!-- Google Fonts
                    ============================================ -->
<link
        href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,700,900"
        rel="stylesheet">
<!-- Bootstrap CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/bootstrap.min.css" %}'>
<!-- Bootstrap CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/font-awesome.min.css" %}'>
<!-- owl.carousel CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/owl.carousel.css" %}'>
<link rel="stylesheet" href='{% static "css/owl.theme.css" %}'>
<link rel="stylesheet" href='{% static "css/owl.transitions.css" %}'>
<!-- animate CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/animate.css" %}'>
<!-- normalize CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/normalize.css" %}'>
<!-- meanmenu icon CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/meanmenu.min.css" %}'>
<!-- main CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/main.css" %}'>
<!-- educate icon CSS
                    ============================================ -->
<link rel="stylesheet" href='{% static "css/educate-custon-icon.css" %}'>
<!-- mCustomScrollbar CSS
                    ============================================ -->
<link rel="stylesheet"
      href='{% static "css/scrollbar/jquery.mCustomScrollbar.min.css" %}'>
<!-- metisMenu CSS
                    ============================================ -->
<link rel="stylesheet"
      href='{% static "css/metisMenu/metisMenu.min.css" %}'>
<link rel="stylesheet"
      href='{% static "css/metisMenu/metisMenu-vertical.css" %}'>
<!-- modernizr JS
                    ============================================ -->
<script src='{% static "js/vendor/modernizr-2.8.3.min.js" %}'></script>
{% endblock %}
{% block content %}
<div class="mailbox-area mg-b-15">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                {% include 'partial/messages-alerts.html' %}
            </div>
            <div class="col-md-12 col-md-12 col-sm-12 col-xs-12">
                <div class="hpanel">
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-md-6 col-md-6 col-sm-6 col-xs-8">
                                <div class="btn-group ib-btn-gp active-hook mail-btn-sd mg-b-15">
                                    <button onClick="window.location.reload()" class="btn btn-etabib btn-sm">
                                        <i class="fa fa-refresh"></i>
                                        {% trans 'Rafra√Æchir' %}
                                    </button>
                                    <button onclick="markNotificationsAsRead(this)" class="btn btn-etabib btn-sm"
                                            data-toggle="tooltip" data-placement="top"
                                            title="{% trans 'Marquer tout comme lu' %}"><i class="fa fa-check"></i></button>
                                    <button onclick="markNotificationsAsUnread(this)" class="btn btn-etabib btn-sm"
                                            data-toggle="tooltip" data-placement="top"
                                            title="{% trans 'marquer tout comme non lu' %}"><i class="fa fa-square-o"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="notifications-list">
                            {% include page_template %}
                        </div>
                    </div>
                    <div class="panel-footer ib-ml-ft bg-dark-blue">
                        <i class="fa fa-eye"> </i> {{notifications_count}} {% trans 'unread' %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block js %}
<!-- bootstrap JS
                    ============================================ -->
<script src='{% static "js/bootstrap.min.js" %}'></script>
<!-- wow JS
                    ============================================ -->
<script src='{% static "js/wow.min.js" %}'></script>
<!-- price-slider JS
                    ============================================ -->
<script src='{% static "js/jquery-price-slider.js" %}'></script>
<!-- meanmenu JS
                    ============================================ -->
<script src='{% static "js/jquery.meanmenu.js" %}'></script>
<!-- owl.carousel JS
                    ============================================ -->
<script src='{% static "js/owl.carousel.min.js" %}'></script>
<!-- sticky JS
                    ============================================ -->
<script src='{% static "js/jquery.sticky.js" %}'></script>
<!-- scrollUp JS
                    ============================================ -->
<script src='{% static "js/jquery.scrollUp.min.js" %}'></script>
<!-- counterup JS
                    ============================================ -->
<script src='{% static "js/counterup/jquery.counterup.min.js" %}'></script>
<script src='{% static "js/counterup/waypoints.min.js" %}'></script>
<script src='{% static "js/counterup/counterup-active.js" %}'></script>
<!-- mCustomScrollbar JS
                    ============================================ -->
<script
        src='{% static "js/scrollbar/jquery.mCustomScrollbar.concat.min.js" %}'></script>
<script src='{% static "js/scrollbar/mCustomScrollbar-active.js" %}'></script>
<!-- metisMenu JS
                    ============================================ -->
<script src='{% static "js/metisMenu/metisMenu.min.js" %}'></script>
<script src='{% static "js/metisMenu/metisMenu-active.js" %}'></script>
<!-- plugins JS
                    ============================================ -->
<script src='{% static "js/plugins.js" %}'></script>
<!-- main JS
                    ============================================ -->
<script src='{% static "js/main.js" %}'></script>
<!-- tawk chat JS
                    ============================================ -->
{% include 'partial/tawk-script.html' %}
<!-- endless pagination JS ============================================ -->
<script src='{% static "el-pagination/js/el-pagination.js" %}'></script>
<script>
     function markNotificationsAsRead(param) {
        //Mark all notifications as read
        var data = {
                     'csrfmiddlewaretoken': '{{ csrf_token }}'
                   };
        $(param).find('i').removeClass("fa fa-check").addClass("fa fa-spinner fa-spin");
        $.post( "{% url 'mark-all-notifications-as-read' %}", data, function(response) {
            $(param).find('i').removeClass("fa fa-spinner fa-spin").addClass("fa fa-check");
            //update unread notifications count
            $(".panel-footer.ib-ml-ft").html("<i class=\"fa fa-eye\"> </i> " + response.notifications_count);
            //set Notification css class
            $(".notifications-list .media").addClass("read");
        })
        .fail(function(response) {
            $(param).find('i').removeClass("fa fa-spinner fa-spin").addClass("fa fa-check");
            console.log(response);
        });
     }

     function markNotificationsAsUnread(param) {
        //Mark all notifications as unread
        var data = {
                     'csrfmiddlewaretoken': '{{ csrf_token }}'
                   };
        $(param).find('i').removeClass("fa fa-square-o").addClass("fa fa-spinner fa-spin");
        $.post( "{% url 'mark-all-notifications-as-unread' %}", data, function(response) {
            $(param).find('i').removeClass("fa fa-spinner fa-spin").addClass("fa fa-square-o");
            //update unread notifications count
            $(".panel-footer.ib-ml-ft").html("<i class=\"fa fa-eye\"> </i> " + response.notifications_count);
            //remove read Notification css class
            $(".notifications-list .media").removeClass("read");
        })
        .fail(function(response) {
            $(param).find('i').removeClass("fa fa-spinner fa-spin").addClass("fa fa-square-o");
        });
     }

      function deleteNotification(event, id, obj) {
        //delete notification
        var data = {
                     'notif_id': id,
                     'csrfmiddlewaretoken': '{{ csrf_token }}'
                   };
        $.post( "{% url 'delete-notification' %}", data, function(response) {
            $(obj).parent().parent().parent().remove();
            //update unread notifications count
            $(".panel-footer.ib-ml-ft").html("<i class=\"fa fa-eye\"> </i> " + response.notifications_count);
        })
        .fail(function(response) {
            console.log(response);
        });
        event.stopPropagation();
      }

	 $(function () {
		 	//Endlesss pagination
	        $.endlessPaginate({paginateOnScroll: true});
	});

</script>
{% endblock %}
